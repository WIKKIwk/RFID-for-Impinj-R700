# ERPNext RFID Integration

A production-ready Frappe/ERPNext application that streamlines RFID tag generation and integrates Impinj R700 readers directly with ERPNext. The app:

- Generates unique RFID identifiers for `Item`, `Serial No`, and `Asset` records using DocType hooks.
- Captures Impinj IoT Device Interface notifications, persists them as `RFID Tag Event` documents, and normalises each read into ReelyActive **raddec** JSON.
- Dispatches raddec payloads to configurable webhooks for downstream middleware.
- Ships with a monitoring workspace, number cards, and shortcuts to keep operations staff informed in real time.

---

## Quick Start

### 1. Install the App

```bash
bench get-app https://github.com/WIKKIwk/RFID-for-Impinj-R700.git
bench --site <site-name> install-app rfid
```

> Replace `<site-name>` with the ERPNext site you want to enable.

### 2. Deploy Workspace Fixtures (optional)

If you want the prebuilt RFID workspace, run the helper script:

```bash
bench --site <site-name> execute rfid.setup.deploy_workspace
```

Otherwise you can manually customise the workspace after installation.

### 3. Create an API User for Impinj

1. In ERPNext go to **User List → Add User** and assign the `System Manager` (or custom) role.
2. Under **API Access**, generate an API Key and Secret.
3. On your Impinj R700, configure an HTTP POST target:
   - URL: `https://<your-domain>/api/method/rfid.rfid.api.ingest_impinj_events`
   - Headers: `Authorization: token <api_key>:<api_secret>`
   - Body: Impinj IoT Device Interface JSON (default format from the reader).

### 4. (Optional) Configure Webhooks

Navigate to **RFID → RFID Webhook** and create one or more endpoints. When tag reads arrive, raddec payloads are pushed asynchronously. Use the `Signing Secret` field if you need HMAC verification (`X-RFID-Signature` header, SHA256).

> Ensure `bench worker --queue short` (or the default worker) is running to deliver webhook jobs.

---

## API Reference

### Ingest Impinj Events

```
POST /api/method/rfid.rfid.api.ingest_impinj_events
Headers: Authorization: token <api_key>:<api_secret>
Body: JSON payload generated by Impinj R700 IoT Device Interface
```

Response summary:

```json
{
  "processed": 1,
  "processed_names": ["639ba5ed9d1421d6"],
  "duplicates": 0,
  "errors": 0,
  "duplicate_tags": [],
  "error_tags": []
}
```

### Fetch raddec Records

```
GET /api/method/rfid.rfid.api.get_raddec_events?limit=50&since=2025-11-05T00:00:00
```

Returns an array of raddec JSON objects including `_docname` for traceability.

---

## Monitoring Console

After installation, open the **RFID** workspace from the ERPNext desk to access:

- **Operations** shortcuts (Print Queue, Serial Numbers, Assets, Stock Entries)
- **Monitoring** cards (pending print jobs, tags created today, tagged assets, recent stock entries, labels printed today)
- **Integrations & Logs** shortcuts (RFID Tag Event, RFID Webhook)

All components rely on native ERPNext DocTypes so you can extend permissions, add reports, or embed dashboards.

---

## Development

### Requirements

- Frappe/ERPNext v15 or newer
- Python ≥ 3.11
- Impinj reader configured to send IoT Device Interface events

Install dependencies in editable mode for development:

```bash
pip install -e .
```

Run the demo test (used for CI/local validation):

```bash
bench --site <site-name> execute rfid.tests.demo.run
```

Feel free to submit pull requests or open issues. Contributions that improve device compatibility, add analytics, or extend webhook integrations are welcome!

---

## License

MIT © reelyActive + contributors
